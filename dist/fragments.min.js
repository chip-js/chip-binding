!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.fragments=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function Class(){}function extend(Subclass){var prototypes,SuperClass=this;"function"!=typeof Subclass?(prototypes=slice.call(arguments),Subclass=function(){SuperClass.apply(this,arguments)}):prototypes=slice.call(arguments,1),Object.setPrototypeOf?Object.setPrototypeOf(Subclass,this):Subclass.__proto__=this,prototypes.forEach(function(proto){"function"==typeof proto?addStatics(proto,Subclass):proto.hasOwnProperty("static")&&addStatics(proto["static"],Subclass)});var descriptors=getDescriptors(prototypes);return descriptors.constructor={writable:!0,configurable:!0,value:Subclass},descriptors["super"]={configurable:!0,value:SuperClass.prototype},Subclass.prototype=Object.create(this.prototype,descriptors),"function"==typeof SuperClass.onExtend&&SuperClass.onExtend(Subclass,prototypes),Subclass}function getDescriptors(objects){var descriptors={};return objects.forEach(function(object){"function"==typeof object&&(object=object.prototype),Object.getOwnPropertyNames(object).forEach(function(name){if("static"!==name){var descriptor=Object.getOwnPropertyDescriptor(object,name);"function"==typeof descriptor.value&&(descriptor.enumerable=!1),descriptors[name]=descriptor}})}),descriptors}function addStatics(statics,Subclass){Object.keys(statics).forEach(function(key){var descriptor=Object.getOwnPropertyDescriptor(statics,key);descriptor.configurable&&Object.defineProperty(Subclass,key,descriptor)})}function makeInstanceOf(object){var args=slice.call(arguments,1);return Object.defineProperties(object,getDescriptors([this.prototype])),this.apply(object,args),object}var slice=Array.prototype.slice;Class.extend=extend,Class.makeInstanceOf=makeInstanceOf,module.exports=Class},{}],2:[function(require,module,exports){module.exports=require("./src/diff")},{"./src/diff":3}],3:[function(require,module,exports){var diff=exports;!function(){function ChangeRecord(object,type,name,oldValue){this.object=object,this.type=type,this.name=name,this.oldValue=oldValue}function Splice(object,index,removed,addedCount){ChangeRecord.call(this,object,"splice",String(index)),this.index=index,this.removed=removed,this.addedCount=addedCount}function clone(value,deep){if(Array.isArray(value))return deep?value.map(function(value){return clone(value,deep)}):value.slice();if(value&&"object"==typeof value){if(value.valueOf()!==value)return new value.constructor(value.valueOf());var copy={};for(var key in value){var objValue=value[key];deep&&(objValue=clone(objValue,deep)),copy[key]=objValue}return copy}return value}function diffValues(value,oldValue){if(value===oldValue)return!1;if(Array.isArray(value)&&Array.isArray(oldValue)){var splices=diffArrays(value,oldValue);return splices.length?splices:!1}if(value&&oldValue&&"object"==typeof value&&"object"==typeof oldValue){var valueValue=value.valueOf(),oldValueValue=oldValue.valueOf();if("object"!=typeof valueValue&&"object"!=typeof oldValueValue)return valueValue!==oldValueValue;var changeRecords=diffObjects(value,oldValue);return changeRecords.length?changeRecords:!1}return diffBasic(value,oldValue)}function diffBasic(value,oldValue){if(value&&oldValue&&"object"==typeof value&&"object"==typeof oldValue){var valueValue=value.valueOf(),oldValueValue=oldValue.valueOf();if("object"!=typeof valueValue&&"object"!=typeof oldValueValue)return diffBasic(valueValue,oldValueValue)}return"number"==typeof value&&"number"==typeof oldValue&&isNaN(value)&&isNaN(oldValue)?!1:value!==oldValue}function diffObjects(value,oldValue){if(!value||!oldValue||"object"!=typeof value||"object"!=typeof oldValue)throw new TypeError("Both values for diff.object must be objects");var prop,propOldValue,propValue,changeRecords=[];for(prop in oldValue)propOldValue=oldValue[prop],propValue=value[prop],(void 0===propValue||diffBasic(propValue,propOldValue))&&(prop in value?diffBasic(propValue,propOldValue)&&changeRecords.push(new ChangeRecord(value,"update",prop,propOldValue)):changeRecords.push(new ChangeRecord(value,"delete",prop,propOldValue)));for(prop in value)propValue=value[prop],prop in oldValue||changeRecords.push(new ChangeRecord(value,"add",prop));return Array.isArray(value)&&value.length!==oldValue.length&&changeRecords.push(new ChangeRecord(value,"update","length",oldValue.length)),changeRecords}function diffArrays(value,oldValue){if(!Array.isArray(value)||!Array.isArray(oldValue))throw new TypeError("Both values for diff.array must be arrays");var currentStart=0,currentEnd=value.length,oldStart=0,oldEnd=oldValue.length,minLength=Math.min(currentEnd,oldEnd),prefixCount=sharedPrefix(value,oldValue,minLength),suffixCount=sharedSuffix(value,oldValue,minLength-prefixCount);if(currentStart+=prefixCount,oldStart+=prefixCount,currentEnd-=suffixCount,oldEnd-=suffixCount,currentEnd-currentStart===0&&oldEnd-oldStart===0)return[];if(currentStart===currentEnd)return[new Splice(value,currentStart,oldValue.slice(oldStart,oldEnd),0)];if(oldStart===oldEnd)return[new Splice(value,currentStart,[],currentEnd-currentStart)];for(var distances=calcEditDistances(value,currentStart,currentEnd,oldValue,oldStart,oldEnd),ops=spliceOperationsFromEditDistances(distances),splice=null,splices=[],index=currentStart,oldIndex=oldStart,i=0,l=ops.length;l>i;i++){var op=ops[i];op===EDIT_LEAVE?(splice&&(splices.push(splice),splice=null),index++,oldIndex++):op===EDIT_UPDATE?(splice||(splice=new Splice(value,index,[],0)),splice.addedCount++,index++,splice.removed.push(oldValue[oldIndex]),oldIndex++):op===EDIT_ADD?(splice||(splice=new Splice(value,index,[],0)),splice.addedCount++,index++):op===EDIT_DELETE&&(splice||(splice=new Splice(value,index,[],0)),splice.removed.push(oldValue[oldIndex]),oldIndex++)}return splice&&splices.push(splice),splices}function sharedPrefix(current,old,searchLength){for(var i=0;searchLength>i;i++)if(diffBasic(current[i],old[i]))return i;return searchLength}function sharedSuffix(current,old,searchLength){for(var index1=current.length,index2=old.length,count=0;searchLength>count&&!diffBasic(current[--index1],old[--index2]);)count++;return count}function spliceOperationsFromEditDistances(distances){for(var i=distances.length-1,j=distances[0].length-1,current=distances[i][j],edits=[];i>0||j>0;)if(0!==i)if(0!==j){var min,northWest=distances[i-1][j-1],west=distances[i-1][j],north=distances[i][j-1];min=north>west?northWest>west?west:northWest:northWest>north?north:northWest,min===northWest?(northWest===current?edits.push(EDIT_LEAVE):(edits.push(EDIT_UPDATE),current=northWest),i--,j--):min===west?(edits.push(EDIT_DELETE),i--,current=west):(edits.push(EDIT_ADD),j--,current=north)}else edits.push(EDIT_DELETE),i--;else edits.push(EDIT_ADD),j--;return edits.reverse(),edits}function calcEditDistances(current,currentStart,currentEnd,old,oldStart,oldEnd){var i,j,rowCount=oldEnd-oldStart+1,columnCount=currentEnd-currentStart+1,distances=new Array(rowCount);for(i=0;rowCount>i;i++)distances[i]=new Array(columnCount),distances[i][0]=i;for(j=0;columnCount>j;j++)distances[0][j]=j;for(i=1;rowCount>i;i++)for(j=1;columnCount>j;j++)if(diffBasic(current[currentStart+j-1],old[oldStart+i-1])){var north=distances[i-1][j]+1,west=distances[i][j-1]+1;distances[i][j]=west>north?north:west}else distances[i][j]=distances[i-1][j-1];return distances}diff.clone=clone,diff.values=diffValues,diff.basic=diffBasic,diff.objects=diffObjects,diff.arrays=diffArrays,Splice.prototype=Object.create(ChangeRecord.prototype);var EDIT_LEAVE=0,EDIT_UPDATE=1,EDIT_ADD=2,EDIT_DELETE=3}()},{}],4:[function(require,module,exports){module.exports=require("./src/expressions")},{"./src/expressions":5}],5:[function(require,module,exports){function getVariables(globals,extraArgs){var variables={};return Object.keys(exports.globals).forEach(function(key){variables[key]=exports.globals[key]}),globals&&Object.keys(globals).forEach(function(key){variables[key]=globals[key]}),extraArgs.forEach(function(key){variables[key]=null}),variables}function compileExpression(original,expr,globals,formatters,extraArgs){var func,args=["_globals_","_formatters_"].concat(extraArgs).concat(expr);try{func=Function.apply(null,args)}catch(e){throw new Error("Bad expression: "+original+"\nCompiled expression:\n"+expr+"\n"+e.message)}return bindArguments(func,globals,formatters)}function bindArguments(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)))}}var slice=Array.prototype.slice,strings=require("./strings"),formatterParser=require("./formatters"),propertyChains=require("./property-chains"),valueProperty="_value_",cache={};exports.globals={},exports.parse=function(expr,globals,formatters){if("string"!=typeof expr)throw new TypeError("Invalid expr, must be type String");var extraArgs=slice.call(arguments,3),cacheKey=expr+"|"+extraArgs.join(","),func=cache[cacheKey];if(func)return func;var original=expr,isSetter=extraArgs[0]===valueProperty;if(expr=strings.pullOutStrings(expr),expr=formatterParser.parseFormatters(expr),expr=propertyChains.parseExpression(expr,getVariables(globals,extraArgs)),!isSetter){var lines=expr.split("\n");lines[lines.length-1]="return "+lines[lines.length-1],expr=lines.join("\n")}return expr=strings.putInStrings(expr),func=compileExpression(original,expr,globals,formatters,extraArgs),func.expr=expr,cache[cacheKey]=func,func},exports.parseSetter=function(expr,globals,formatters,extraArgs){var extraArgs=slice.call(arguments,3);return expr="!"===expr.charAt(0)?expr.slice(1).replace(/(\s*\||$)/," = !_value_$1"):expr.replace(/(\s*\||$)/," = _value_$1"),exports.parse.apply(exports,[expr,globals,formatters,valueProperty].concat(extraArgs))}},{"./formatters":6,"./property-chains":7,"./strings":8}],6:[function(require,module,exports){var pipeRegex=/\|(\|)?/g,placeholder="@@@",placeholderRegex=new RegExp("\\s*"+placeholder+"\\s*"),setterRegex=/\s=\s/,formatterRegex=/^([^\(]+)(?:\((.*)\))?$/,argSeparator=/\s*,\s*/g;exports.parseFormatters=function(expr){if(expr=expr.replace(pipeRegex,function(match,orIndicator){return orIndicator?match:placeholder}),formatters=expr.split(placeholderRegex),expr=formatters.shift(),!formatters.length)return expr;var setter="",value=expr;if(setterRegex.test(expr)){var parts=expr.split(setterRegex);setter=parts[0]+" = ",value=parts[1]}return formatters.forEach(function(formatter){var match=formatter.trim().match(formatterRegex);if(!match)throw new Error("Formatter is invalid: "+formatter);var formatterName=match[1],args=match[2]?match[2].split(argSeparator):[];args.unshift(value),setter&&args.push(!0),value="_formatters_."+formatterName+".call(this, "+args.join(", ")+")"}),setter+value}},{}],7:[function(require,module,exports){function parsePropertyChains(expr){var chain,parsedExpr="",prevCurrentIndex=currentIndex,prevLastIndex=propertyRegex.lastIndex;for(currentIndex=0,propertyRegex.lastIndex=0;(chain=nextChain(expr))!==!1;)parsedExpr+=chain;return currentIndex=prevCurrentIndex,propertyRegex.lastIndex=prevLastIndex,parsedExpr}function nextChain(expr){if(finishedChain)return finishedChain=!1;var match=propertyRegex.exec(expr);if(!match)return finishedChain=!0,expr.slice(currentIndex);var prefix=match[1],objIndicator=match[2],propChain=match[3],postfix=match[4],colonOrParen=match[5];match=match[0];var skipped=expr.slice(currentIndex,propertyRegex.lastIndex-match.length);return currentIndex=propertyRegex.lastIndex,objIndicator&&":"===colonOrParen?skipped+match:skipped+parseChain(prefix,propChain,postfix,colonOrParen,expr)}function parseChain(prefix,propChain,postfix,paren,expr){continuation="."===prefix,continuation&&(propChain="."+propChain,prefix="");var links=splitLinks(propChain),newChain="";return 1!==links.length||continuation||parens[paren]?(continuation||(newChain="("),links.forEach(function(link,index){index!==links.length-1?newChain+=parsePart(link,index):parens[paren]?(continuation&&0===index&&index++,postfix=postfix.replace(paren,""),newChain+="("===paren?parseFunction(link,index,expr):parseBrackets(link,index,expr)):newChain+="_ref"+currentReference+link}),"."!==expr.charAt(propertyRegex.lastIndex)&&(newChain+=")")):(link=links[0],newChain=addThisOrGlobal(link)),prefix+newChain+postfix}function splitLinks(chain){for(var match,index=0,parts=[];match=chainLinksRegex.exec(chain);)1!==chainLinksRegex.lastIndex&&(parts.push(chain.slice(index,chainLinksRegex.lastIndex-1)),index=chainLinksRegex.lastIndex-1);return parts.push(chain.slice(index)),parts}function addThisOrGlobal(chain){var prop=chain.split(chainLinkRegex).shift();return globals.hasOwnProperty(prop)?null===globals[prop]?chain:"_globals_."+chain:defaultGlobals.hasOwnProperty(prop)?chain:"this."+chain}function parseFunction(link,index,expr){var call=getFunctionCall(expr);link=0===index?addThisOrGlobal(link):"_ref"+currentReference+link;var calledLink=link+"(~~insideParens~~)";link="typeof "+link+" !== 'function' ? void 0 : "+calledLink;var insideParens=call.slice(1,-1);if("."===expr.charAt(propertyRegex.lastIndex)){currentReference=++referenceCount;var ref="_ref"+currentReference;link="("+ref+" = ("+link+")) == null ? void 0 : "}var ref=currentReference;return link=link.replace("~~insideParens~~",parsePropertyChains(insideParens)),currentReference=ref,link}function parseBrackets(link,index,expr){var call=getFunctionCall(expr),insideBrackets=call.slice(1,-1),evaledLink=parsePart(link,index);index+=1,link="[~~insideBrackets~~]",link="."===expr.charAt(propertyRegex.lastIndex)?parsePart(link,index):"_ref"+currentReference+link,link=evaledLink+link;var ref=currentReference;return link=link.replace("~~insideBrackets~~",parsePropertyChains(insideBrackets)),currentReference=ref,link}function getFunctionCall(expr){for(var startIndex=propertyRegex.lastIndex,open=expr.charAt(startIndex-1),close=parens[open],endIndex=startIndex-1,parenCount=1;endIndex++<expr.length;){var ch=expr.charAt(endIndex);if(ch===open?parenCount++:ch===close&&parenCount--,0===parenCount)break}return currentIndex=propertyRegex.lastIndex=endIndex+1,open+expr.slice(startIndex,endIndex)+close}function parsePart(part,index){part=0!==index||continuation?"_ref"+currentReference+part:addThisOrGlobal(part),currentReference=++referenceCount;var ref="_ref"+currentReference;return"("+ref+" = "+part+") == null ? void 0 : "}function replaceSubstitutions(expr){return Object.keys(substitutions).forEach(function(replacement){expr=expr.replace(substitutions[replacement],replacement)}),expr}function addReferences(expr){if(referenceCount){for(var refs=[],i=1;referenceCount>=i;i++)refs.push("_ref"+i);expr="var "+refs.join(", ")+";\n"+expr}return expr}var referenceCount=0,currentReference=0,currentIndex=0,finishedChain=!1,continuation=!1,globals=null,defaultGlobals={"return":null,"true":null,"false":null,undefined:null,"null":null,"this":null,window:null,Math:null,parseInt:null,parseFloat:null,isNaN:null,Array:null,"typeof":null,encodeURI:null,encodeURIComponent:null,Boolean:null,String:null,Number:null,Infinity:null,NaN:null,_globals_:null,_formatters_:null,_value_:null},propertyRegex=/((\{|,|\.)?\s*)([a-z$_\$](?:[a-z_\$0-9\.-]|\[['"\d]+\])*)(\s*(:|\(|\[)?)/gi,chainLinksRegex=/\.|\[/g,chainLinkRegex=/\.|\[|\(/,substitutions={" && ":/ and /g," || ":/ or /g," === ":/ is /g};exports.parseExpression=function(expr,_globals){if(referenceCount=0,currentReference=0,currentIndex=0,finishedChain=!1,continuation=!1,globals=_globals,expr=replaceSubstitutions(expr),-1!==expr.indexOf(" = ")){var parts=expr.split(" = "),setter=parts[0],value=parts[1];setter=parsePropertyChains(setter).replace(/^\(|\)$/g,""),value=parsePropertyChains(value),expr=setter+" = "+value}else expr=parsePropertyChains(expr);return expr=addReferences(expr),globals=null,expr};var parens={"(":")","[":"]"}},{}],8:[function(require,module,exports){var quoteRegex=/(['"\/])(\\\1|[^\1])*?\1/g,emptyQuoteExpr=/(['"\/])\1/g,strings=null;exports.pullOutStrings=function(expr){if(strings)throw new Error("putInStrings must be called after pullOutStrings.");return strings=[],expr.replace(quoteRegex,function(str,quote){return strings.push(str),quote+quote})},exports.putInStrings=function(expr){if(!strings)throw new Error("pullOutStrings must be called before putInStrings.");return expr=expr.replace(emptyQuoteExpr,function(){return strings.shift()}),strings=null,expr}},{}],9:[function(require,module,exports){function create(options){options=options||{};var observations=Observations.create();options.observations=observations;var fragments=new Fragments(options);return fragments.sync=observations.sync,fragments.syncNow=observations.syncNow,fragments.afterSync=observations.afterSync,fragments.onSync=observations.onSync,fragments.offSync=observations.offSync,fragments}var Fragments=require("./src/fragments"),Observations=require("observations-js");exports.create=create},{"./src/fragments":14,"observations-js":20}],10:[function(require,module,exports){function AnimatedBinding(properties){var element=properties.node,animate=element.getAttribute(properties.fragments.animateAttribute),fragments=properties.fragments;if(null!==animate){if("TEMPLATE"===element.nodeName||"SCRIPT"===element.nodeName)throw new Error("Cannot animate multiple nodes in a template or script. Remove the [animate] attribute.");if(setTimeout(function(){element.removeAttribute(properties.fragments.animateAttribute)}),this.animate=!0,fragments.isBound("attribute",animate))this.animateExpression=fragments.codifyExpression("attribute",animate);else if("."===animate[0])this.animateClassName=animate.slice(1);else if(animate){var animateObject=fragments.getAnimation(animate);"function"==typeof animateObject&&(animateObject=new animateObject(this)),this.animateObject=animateObject}}Binding.call(this,properties)}function getDuration(node,direction){var milliseconds=this.clonedFrom["__animationDuration"+direction];if(!milliseconds){var styles=window.getComputedStyle(node),seconds=Math.max(parseFloat(styles[transitionDurationName]||0)+parseFloat(styles[transitionDelayName]||0),parseFloat(styles[animationDurationName]||0)+parseFloat(styles[animationDelayName]||0));milliseconds=1e3*seconds||0,this.clonedFrom["__animationDuration"+direction]=milliseconds}return milliseconds}function onAnimationEnd(node,duration,callback){var onEnd=function(){node.removeEventListener(transitionEventName,onEnd),node.removeEventListener(animationEventName,onEnd),clearTimeout(timeout),callback()},timeout=setTimeout(onEnd,duration+10);node.addEventListener(transitionEventName,onEnd),node.addEventListener(animationEventName,onEnd)}module.exports=AnimatedBinding;var animation=require("./util/animation"),Binding=require("./binding"),_super=Binding.prototype;Binding.extend(AnimatedBinding,{init:function(){_super.init.call(this),this.animateExpression&&(this.animateObserver=new this.Observer(this.animateExpression,function(value){this.animateObject=value},this))},bind:function(context){this.context!=context&&(_super.bind.call(this,context),this.animateObserver&&this.animateObserver.bind(context))},unbind:function(){null!==this.context&&(_super.unbind.call(this),this.animateObserver&&this.animateObserver.unbind())},animateOut:function(node,callback){node.firstViewNode&&(node=node.firstViewNode),this.animateNode("out",node,function(){callback&&callback.call(this)})},animateIn:function(node,callback){node.firstViewNode&&(node=node.firstViewNode),this.animateNode("in",node,callback,this)},animateNode:function(direction,node,callback){var animateObject,className,classAnimateName,classWillName,methodAnimateName,methodWillName,methodDidName,dir,_this=this;this.animateObject&&"object"==typeof this.animateObject?(animateObject=this.animateObject,animateObject.fragments=this.fragments):this.animateClassName?className=this.animateClassName:"string"==typeof this.animateObject&&(className=this.animateObject),classAnimateName="animate-"+direction,classWillName="will-animate-"+direction,dir="in"===direction?"In":"Out",methodAnimateName="animate"+dir,methodWillName="willAnimate"+dir,methodDidName="didAnimate"+dir,className&&node.classList.add(className),node.classList.add(classWillName),animateObject&&(animation.makeElementAnimatable(node),animateObject[methodWillName]&&animateObject[methodWillName](node)),node.offsetWidth=node.offsetWidth,node.classList.add(classAnimateName),node.classList.remove(classWillName),node.dispatchEvent(new Event("animatestart"+direction));var whenDone=function(){animateObject&&animateObject[methodDidName]&&animateObject[methodDidName](node),callback&&callback.call(_this),node.classList.remove(classAnimateName),className&&node.classList.remove(className),node.dispatchEvent(new Event("animateend"+direction))};if(animateObject&&animateObject[methodAnimateName])animateObject[methodAnimateName](node,whenDone);else{var duration=getDuration.call(this,node,direction);duration?onAnimationEnd(node,duration,whenDone):requestAnimationFrame(function(){requestAnimationFrame(whenDone)})}}});var transitionDurationName="transitionDuration",transitionDelayName="transitionDelay",animationDurationName="animationDuration",animationDelayName="animationDelay",transitionEventName="transitionend",animationEventName="animationend",style=document.documentElement.style;["webkit","moz","ms","o"].forEach(function(prefix){void 0===style.transitionDuration&&style[prefix+"TransitionDuration"]&&(transitionDurationName=prefix+"TransitionDuration",transitionDelayName=prefix+"TransitionDelay",transitionEventName=prefix+"transitionend"),void 0===style.animationDuration&&style[prefix+"AnimationDuration"]&&(animationDurationName=prefix+"AnimationDuration",animationDelayName=prefix+"AnimationDelay",animationEventName=prefix+"animationend")})},{"./binding":11,"./util/animation":16}],11:[function(require,module,exports){function Binding(properties){if(!properties.node||!properties.view)throw new TypeError("A binding must receive a node and a view");this._elementPath=initNodePath(properties.node,properties.view),this.node=properties.node,this.element=properties.node,this.name=properties.name,this.match=properties.match,this.expression=properties.expression,this.fragments=properties.fragments,this.observations=properties.fragments.observations,this.context=null}function initNodePath(node,view){for(var path=[];node!==view;){var parent=node.parentNode;path.unshift(indexOf.call(parent.childNodes,node)),node=parent}return path}module.exports=Binding;var ElementController=require("./element-controller");ElementController.extend(Binding,{priority:0,init:function(){ElementController.call(this,this.observations),this.observersEnabled=!1,this.listenersEnabled=!1,this.expression&&this.updated!==Binding.prototype.updated&&(this.observer=this.watch(this.expression,this.updated,this)),this.created()},cloneForView:function(view){if(!view)throw new TypeError("A binding must clone against a view");var node=view;this._elementPath.forEach(function(index){node=node.childNodes[index]});var binding=Object.create(this);return binding.clonedFrom=this,binding.view=view,binding.element=node,binding.node=node,binding.init(),binding},bind:function(context){this.context!=context&&(this.context=this._context=context,this.bound(),this.observersEnabled=!0)},unbind:function(){null!==this.context&&(this.observersStop(),this.unbound(),this.context=this._context=null)},attach:function(){this.listenersEnabled=!0,this.attached()},detach:function(){this.listenersEnabled=!1,this.detached()},dispose:function(){this.unbind(),this.observersEnabled=!1,this.disposed()},sync:function(){this.context&&this.observer&&this.updated!==Binding.prototype.updated&&this.observer.sync()},compiled:function(){},created:function(){},updated:function(){},bound:function(){},unbound:function(){},attached:function(){},detached:function(){},disposed:function(){},get camelCase(){return(this.match||this.name||"").replace(/-+(\w)/g,function(_,char){return char.toUpperCase()})},observe:function(expression,callback,callbackContext){return this.watch(expression,callback,callbackContext)}});var indexOf=Array.prototype.indexOf},{"./element-controller":13}],12:[function(require,module,exports){function compile(fragments,template){var currentNode,parentNode,previousNode,walker=document.createTreeWalker(template,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT),bindings=[];walker.nextNode(),walker.previousNode();do currentNode=walker.currentNode,parentNode=currentNode.parentNode,bindings.push.apply(bindings,getBindingsForNode(fragments,currentNode,template)),currentNode.parentNode!==parentNode?walker.currentNode=previousNode||walker.root:previousNode=currentNode;while(walker.nextNode());return bindings}function getBindingsForNode(fragments,node,view){var Binder,binding,expr,bound,match,attr,i,l,bindings=[];if(node.nodeType===Node.TEXT_NODE)splitTextNode(fragments,node),fragments.isBound("text",node.nodeValue)&&(expr=fragments.codifyExpression("text",node.nodeValue),node.nodeValue="",Binder=fragments.findBinder("text",expr),Binder.expression&&(expr=expr.match(Binder.expression)[1]),binding=new Binder({node:node,view:view,expression:expr,fragments:fragments}),binding.compiled()!==!1&&bindings.push(binding));else{var parent=node.parentNode,DefaultBinder=fragments.getAttributeBinder("__default__");bound=[],Binder=fragments.findBinder("element",node.tagName.toLowerCase()),Binder&&bound.push([Binder]);var attributes=slice.call(node.attributes);for(i=0,l=attributes.length;l>i;i++)attr=attributes[i],Binder=fragments.findBinder("attribute",attr.name,attr.value),Binder&&bound.push([Binder,attr]);for(bound.sort(sortBindings),i=0;i<bound.length;i++){if(Binder=bound[i][0],attr=bound[i][1]){if(!node.hasAttribute(attr.name))continue;var name=attr.name,value=attr.value;Binder.expression?(match=name.match(Binder.expression),match&&(match=match[1])):match=null,attr&&node.hasAttribute(attr.name)&&node.removeAttribute(attr.name),binding=new Binder({node:node,view:view,name:name,match:match,expression:value?fragments.codifyExpression("attribute",value,Binder!==DefaultBinder):null,fragments:fragments})}else binding=new Binder({node:node,view:view,fragments:fragments});if(binding.compiled()!==!1?bindings.push(binding):attr&&Binder!==DefaultBinder&&fragments.isBound("attribute",value)?bound.push([DefaultBinder,attr]):attr&&node.setAttributeNode(attr),node.parentNode!==parent)break}}return bindings}function splitTextNode(fragments,node){if(!node.processed){node.processed=!0;var regex=fragments.binders.text._expr,content=node.nodeValue;if(content.match(regex)){for(var match,lastIndex=0,parts=[],fragment=document.createDocumentFragment();match=regex.exec(content);)parts.push(content.slice(lastIndex,regex.lastIndex-match[0].length)),parts.push(match[0]),lastIndex=regex.lastIndex;parts.push(content.slice(lastIndex)),parts=parts.filter(notEmpty),node.nodeValue=parts[0];for(var i=1;i<parts.length;i++){var newTextNode=document.createTextNode(parts[i]);newTextNode.processed=!0,fragment.appendChild(newTextNode)}node.parentNode.insertBefore(fragment,node.nextSibling)}}}function sortBindings(a,b){return b[0].prototype.priority-a[0].prototype.priority}function notEmpty(value){return Boolean(value)}var slice=Array.prototype.slice;module.exports=compile},{}],13:[function(require,module,exports){function ElementController(observations){ObservableHash.call(this,observations),Object.defineProperties(this,{_listeners:{value:[]}}),this._listeners.enabled=!0}function getTarget(component,target){var element=component instanceof Node?component:component.element;return"string"==typeof target?target=component[target]||element.querySelector(target):target===Document?target=element.ownerDocument:target===Window&&(target=element.ownerDocument.defaultView),target}function addListener(component,target,eventName,listener){return(target=getTarget(component,target))?(target.addEventListener(eventName,listener),target):void 0}function removeListener(target,eventName,listener){target&&target.removeEventListener(eventName,listener)}module.exports=ElementController;var ObservableHash=require("observations-js").ObservableHash;ObservableHash.extend(ElementController,{get listenersEnabled(){return this._listeners.enabled},set listenersEnabled(value){this.enabled!==value&&(this._listeners.enabled=value,value?this._listeners.forEach(function(item){item.targetRef=addListener(this,item.target,item.eventName,item.listener)},this):this._listeners.forEach(function(item){removeListener(item.targetRef,item.eventName,item.listener),delete item.targetRef},this))},listen:function(target,eventName,listener,context){var element=this instanceof Node?this:this.element;if("function"==typeof eventName&&(context=listener,listener=eventName,eventName=target,target=element),!target||"function"!=typeof listener)throw new TypeError("`listen([target], eventName, listener)` must have a function listener");if(listener=listener.bind(context||this),"string"==typeof target){var innerListener=listener,selector=target;target=element,listener=function(event){this[selector]instanceof Node&&this[selector].contains(event.target)?innerListener(event):event.target.closest(selector)&&innerListener(event)}.bind(this)}var listenerData={target:target,eventName:eventName,listener:listener,targetRef:null};this._listeners.push(listenerData),this.listenersEnabled&&(listenerData.targetRef=addListener(this,target,eventName,listener))}})},{"observations-js":20}],14:[function(require,module,exports){function Fragments(options){if(!options||!options.observations)throw new TypeError("Must provide an observations instance to Fragments in options.");this.compiling=!1,this.observations=options.observations,this.globals=options.observations.globals,this.formatters=options.observations.formatters,this.animations={},this.animateAttribute="animate",this.binders={element:{_wildcards:[]},attribute:{_wildcards:[],_expr:/{{\s*(.*?)\s*}}(?!})/g,_delimitersOnlyInDefault:!1},text:{_wildcards:[],_expr:/{{\s*(.*?)\s*}}(?!})/g}},this.registerText("__default__",function(value){this.element.textContent=null!=value?value:""}),this.registerText("{*}",function(value){this.content&&(this.content.remove(),this.content=null),("string"==typeof value&&value||value instanceof Node)&&(this.content=View.makeInstanceOf(toFragment(value)),this.element.parentNode.insertBefore(this.content,this.element.nextSibling))}),this.registerAttribute("__default__",function(value){null!=value?this.element.setAttribute(this.name,value):this.element.removeAttribute(this.name)}),this.addOptions(options)}function escapeRegExp(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function processOption(obj,fragments,methodName){obj&&Object.keys(obj).forEach(function(name){fragments[methodName](name,obj[name])})}module.exports=Fragments,require("./util/polyfills");var Class=require("chip-utils/class"),toFragment=require("./util/toFragment"),animation=require("./util/animation"),Template=require("./template"),View=require("./view"),Binding=require("./binding"),AnimatedBinding=require("./animated-binding"),compile=require("./compile"),hasWildcardExpr=/(^|[^\\])\*/,escapedWildcardExpr=/(^|[^\\])\\\*/;Class.extend(Fragments,{addOptions:function(options){options&&(processOption(options.binders,this,"registerAttribute"),processOption(options.formatters,this,"registerFormatter"),processOption(options.animations,this,"registerAnimation"));
},createTemplate:function(html){if(!html)throw new TypeError("Invalid html, cannot create a template from: "+html);var fragment=toFragment(html);if(0===fragment.childNodes.length)throw new Error("Cannot create a template from "+html+" because it is empty.");var template=Template.makeInstanceOf(fragment);return this.compileTemplate(template),template},compileTemplate:function(template){if(template&&!template.compiled){var lastCompilingValue=this.compiling;this.compiling=!0,template.compiled=!0,template.bindings=compile(this,template),this.compiling=lastCompilingValue}return template},compileElement:function(element){return element.bindings||(element.bindings=compile(this,element),View.makeInstanceOf(element)),element},bindElement:function(element,context){return this.compileElement(element),context&&element.bind(context),element},observe:function(context,expr,callback,callbackContext){"string"==typeof context&&(callbackContext=callback,callback=expr,expr=context,context=null);var observer=this.observations.createObserver(expr,callback,callbackContext);return context&&observer.bind(context,!0),observer},registerElement:function(name,definition){return this.registerBinder("element",name,definition)},registerAttribute:function(name,definition){return this.registerBinder("attribute",name,definition)},registerText:function(name,definition){return this.registerBinder("text",name,definition)},registerBinder:function(type,name,definition){function Binder(){superClass.apply(this,arguments)}if(!definition)throw new TypeError("Must provide a definition when registering a binder");var binders=this.binders[type],superClass=definition.animated?AnimatedBinding:Binding;if(!binders)throw new TypeError("`type` must be one of "+Object.keys(this.binders).join(", "));"function"==typeof definition&&(definition.prototype instanceof Binding?(superClass=definition,definition={}):definition={updated:definition}),"__default__"!==name||definition.hasOwnProperty("priority")||(definition.priority=-100),binders[name]&&this.unregisterBinder(type,name),superClass.extend(Binder,definition);var expr;return name instanceof RegExp?expr=name:hasWildcardExpr.test(name)&&(expr=new RegExp("^"+escapeRegExp(name).replace(escapedWildcardExpr,"$1(.*)")+"$")),expr&&(Binder.expression=expr,binders._wildcards.push(Binder),binders._wildcards.sort(this.bindingSort)),Binder.name=""+name,binders[name]=Binder,Binder},unregisterElement:function(name){return this.unregisterBinder("element",name)},unregisterAttribute:function(name){return this.unregisterBinder("attribute",name)},unregisterText:function(name){return this.unregisterBinder("text",name)},unregisterBinder:function(type,name){var binder=this.getBinder(type,name),binders=this.binders[type];if(binder){if(binder.expression){var index=binders._wildcards.indexOf(binder);index>=0&&binders._wildcards.splice(index,1)}return delete binders[name],binder}},getElementBinder:function(name){return this.getBinder("element",name)},getAttributeBinder:function(name){return this.getBinder("attribute",name)},getTextBinder:function(name){return this.getBinder("text",name)},getBinder:function(type,name){var binders=this.binders[type];if(!binders)throw new TypeError("`type` must be one of "+Object.keys(this.binders).join(", "));return name&&binders.hasOwnProperty(name)?binders[name]:void 0},findBinder:function(type,name,value){if("text"===type&&null==value&&(value=name,name=void 0),name!==this.animateAttribute){var binder=this.getBinder(type,name),binders=this.binders[type];if(!binder){var toMatch="text"===type?value:name;binders._wildcards.some(function(wildcardBinder){return toMatch.match(wildcardBinder.expression)?(binder=wildcardBinder,!0):void 0})}if(!binder||"attribute"!==type||!binder.prototype.onlyWhenBound||this.binders[type]._delimitersOnlyInDefault||this.isBound(type,value))return binder||!value||"text"!==type&&!this.isBound(type,value)||(binder=this.getBinder(type,"__default__")),binder}},registerFormatter:function(name,formatter){this.formatters[name]=formatter},unregisterFormatter:function(name){delete this.formatters[name]},getFormatter:function(name){return this.formatters[name]},registerAnimation:function(name,animationObject){this.animations[name]=animationObject},unregisterAnimation:function(name){delete this.animations[name]},getAnimation:function(name){return this.animations[name]},makeElementAnimatable:animation.makeElementAnimatable,setExpressionDelimiters:function(type,pre,post,onlyInDefault){if("attribute"!==type&&"text"!==type)throw new TypeError('Expression delimiters must be of type "attribute" or "text"');this.binders[type]._expr=new RegExp(escapeRegExp(pre)+"(.*?)"+escapeRegExp(post),"g"),"attribute"===type&&(this.binders[type]._delimitersOnlyInDefault=!!onlyInDefault)},isBound:function(type,value){if("attribute"!==type&&"text"!==type)throw new TypeError('isBound must provide type "attribute" or "text"');var expr=this.binders[type]._expr;return Boolean(expr&&value&&value.match(expr))},bindingSort:function(a,b){return b.prototype.priority-a.prototype.priority},codifyExpression:function(type,text,notDefault){if("attribute"!==type&&"text"!==type)throw new TypeError('codifyExpression must use type "attribute" or "text"');if(notDefault&&this.binders[type]._delimitersOnlyInDefault)return text;var expr=this.binders[type]._expr,match=text.match(expr);if(match){if(1===match.length&&match[0]===text)return text.replace(expr,"$1");for(var newText='"',lastIndex=0;match=expr.exec(text);){var str=text.slice(lastIndex,expr.lastIndex-match[0].length);newText+=str.replace(/"/g,'\\"'),newText+='" + ('+match[1]+' || "") + "',lastIndex=expr.lastIndex}return newText+=text.slice(lastIndex).replace(/"/g,'\\"')+'"',newText.replace(/^"" \+ | "" \+ | \+ ""$/g,"")}return'"'+text.replace(/"/g,'\\"')+'"'}})},{"./animated-binding":10,"./binding":11,"./compile":12,"./template":15,"./util/animation":16,"./util/polyfills":17,"./util/toFragment":18,"./view":19,"chip-utils/class":1}],15:[function(require,module,exports){function Template(){this.compiled=!1,this.pool=[]}module.exports=Template;var View=require("./view"),Class=require("chip-utils/class");Class.extend(Template,{createView:function(){return this.pool.length?this.pool.pop():View.makeInstanceOf(document.importNode(this,!0),this)},returnView:function(view){-1===this.pool.indexOf(view)&&this.pool.push(view)}})},{"./view":19,"chip-utils/class":1}],16:[function(require,module,exports){function makeElementAnimatable(element){return element.animate||(element.animate=animateElement),element.getComputedCSS||(element.getComputedCSS=getComputedCSS),element}function getComputedCSS(styleName){return this.ownerDocument.defaultView.opener?this.ownerDocument.defaultView.getComputedStyle(this)[styleName]:window.getComputedStyle(this)[styleName]}function animateElement(css,options){var playback={onfinish:null};if(!Array.isArray(css)||2!==css.length||!options||!options.hasOwnProperty("duration"))return Promise.resolve().then(function(){playback.onfinish&&playback.onfinish()}),playback;var element=this,duration=options.duration||0,delay=options.delay||0,easing=options.easing,initialCss=css[0],finalCss=css[1],allCss={};Object.keys(initialCss).forEach(function(key){allCss[key]=!0,element.style[key]=initialCss[key]}),element.offsetWidth;var transitionOptions=" "+duration+"ms";return easing&&(transitionOptions+=" "+easing),delay&&(transitionOptions+=" "+delay+"ms"),element.style.transition=Object.keys(finalCss).map(function(key){return key+transitionOptions}).join(", "),Object.keys(finalCss).forEach(function(key){allCss[key]=!0,element.style[key]=finalCss[key]}),setTimeout(function(){Object.keys(allCss).forEach(function(key){element.style[key]=""}),playback.onfinish&&playback.onfinish()},duration+delay),playback}exports.makeElementAnimatable=makeElementAnimatable,exports.getComputedCSS=getComputedCSS,exports.animateElement=animateElement},{}],17:[function(require,module,exports){Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(selector){var element=this;do if(element.matches(selector))return element;while((element=element.parentNode)&&element.nodeType===Node.ELEMENT_NODE);return null})},{}],18:[function(require,module,exports){function toFragment(html){if("function"==typeof html&&(html=html()),html instanceof DocumentFragment)return html;if("string"==typeof html)return stringToFragment(html);if(html instanceof Node)return nodeToFragment(html);if("length"in html)return listToFragment(html);throw new TypeError("Unsupported Template Type: Cannot convert `"+html+"` into a document fragment.")}function nodeToFragment(node){if(node.content instanceof DocumentFragment)return node.content;if("SCRIPT"===node.tagName)return stringToFragment(node.innerHTML);var fragment=document.createDocumentFragment();if("TEMPLATE"===node.tagName)for(var i=0,l=node.childNodes.length;l>i;i++)fragment.appendChild(node.childNodes[i]);else fragment.appendChild(node);return fragment}function listToFragment(list){for(var fragment=document.createDocumentFragment(),i=0,l=list.length;l>i;i++)fragment.appendChild(toFragment(list[i])),l===list.length+1&&(i--,l--);return fragment}module.exports=toFragment;var stringToFragment=function(string){if(!string){var fragment=document.createDocumentFragment();return fragment.appendChild(document.createTextNode("")),fragment}var templateElement;return templateElement=document.createElement("template"),templateElement.innerHTML=string,templateElement.content};!document.createElement("template").content instanceof DocumentFragment&&(stringToFragment=function(){var tagExp=/<([\w:-]+)/,wrapMap={option:[1,'<select multiple="multiple">',"</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};return wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,function(string){var fragment;if(!string)return fragment=document.createDocumentFragment(),fragment.appendChild(document.createTextNode("")),fragment;var tag=string.match(tagExp),parts=wrapMap[tag]||wrapMap._default,depth=parts[0],prefix=parts[1],postfix=parts[2],div=document.createElement("div");for(div.innerHTML=prefix+string+postfix;depth--;)div=div.lastChild;for(fragment=document.createDocumentFragment();div.firstChild;)fragment.appendChild(div.firstChild);return fragment}}())},{}],19:[function(require,module,exports){function View(template){this.context=null,template||(template=this),this.template=template,this.template.bindings||(this.template.bindings=[]),this.bindings=this.template.bindings.map(function(binding){return binding.cloneForView(this)},this),this.firstViewNode=this.firstChild,this.lastViewNode=this.lastChild,this.firstViewNode&&(this.firstViewNode.view=this,this.lastViewNode.view=this)}module.exports=View;var Class=require("chip-utils/class");Class.extend(View,{get inDOM(){for(var parent=this.firstViewNode,doc=parent.ownerDocument;parent&&parent!==doc;)parent=parent.parentNode||parent.host;return parent===doc},remove:function(){var next,node=this.firstViewNode;if(node.parentNode!==this)for(;node;)next=node===this.lastViewNode?null:node.nextSibling,this.appendChild(node),node=next;this.detached()},dispose:function(){this.bindings.forEach(function(binding){binding.dispose()}),this.context=null,this.remove(),this.template&&this.template.returnView(this)},bind:function(context){this.context=context,this.bindings.forEach(function(binding){binding.bind(context)})},unbind:function(){this.bindings.forEach(function(binding){binding.unbind()}),this.context=null},attached:function(){!this._attached&&this.inDOM&&(this._attached=!0,this.bindings.forEach(function(binding){binding.attach()}))},detached:function(){this._attached&&!this.inDOM&&(this._attached=!1,this.bindings.forEach(function(binding){binding.detach()}))},sync:function(){null!==this.context&&this.bindings.forEach(function(binding){binding.sync()})}})},{"chip-utils/class":1}],20:[function(require,module,exports){exports.Observations=require("./src/observations"),exports.Observer=require("./src/observer"),exports.ObservableHash=require("./src/observable-hash"),exports.create=function(){return new exports.Observations}},{"./src/observable-hash":27,"./src/observations":28,"./src/observer":29}],21:[function(require,module,exports){function ComputedProperty(){}module.exports=ComputedProperty;var Class=require("chip-utils/class");Class.extend(ComputedProperty,{get isComputedProperty(){return!0},addTo:function(observations,computedObject,propertyName,context){throw new Error("Abstract function is not implemented")},watch:function(observations,expression,obj,property,context){return"string"==typeof expression?observations.createObserver(expression,function(value){void 0===value?delete obj[property]:obj[property]=value}):expression.isComputedProperty?expression.addTo(observations,obj,property,context):void 0}})},{"chip-utils/class":1}],22:[function(require,module,exports){function ExprProperty(expression){this.expression=expression}module.exports=ExprProperty;var ComputedProperty=require("./computed-property");ComputedProperty.extend(ExprProperty,{addTo:function(observations,computedObject,propertyName,context){return this.watch(observations,this.expression,computedObject,propertyName,context)}})},{"./computed-property":21}],23:[function(require,module,exports){function IfProperty(ifExpression,thenExpression){this.ifExpression=ifExpression,this.thenExpression=thenExpression}module.exports=IfProperty;var ComputedProperty=require("./computed-property");ComputedProperty.extend(IfProperty,{addTo:function(observations,computedObject,propertyName,context){var observer=this.watch(observations,this.thenExpression,computedObject,propertyName,context);return observations.createObserver(this.ifExpression,function(value){value&&!observer.context?observer.bind(context):!value&&observer.context&&(observer.unbind(),observer.sync())})}})},{"./computed-property":21}],24:[function(require,module,exports){function MapProperty(sourceExpression,keyExpression,resultExpression,removeExpression){var parts=sourceExpression.split(/\s+in\s+/);this.sourceExpression=parts.pop(),this.itemName=parts.pop(),this.keyExpression=keyExpression,this.resultExpression=resultExpression,this.removeExpression=removeExpression}module.exports=MapProperty;var ComputedProperty=require("./computed-property");ComputedProperty.extend(MapProperty,{addTo:function(observations,computedObject,propertyName,context){var map={},observers={};computedObject[propertyName]=map;var add=this.addItem.bind(this,observations,computedObject,map,observers,context),remove=this.removeItem.bind(this,observations,computedObject,map,observers,context);return observations.createMemberObserver(this.sourceExpression,add,remove,this)},addItem:function(observations,computedObject,map,observers,context,item){this.getKey||(this.getKey=observations.getExpression(this.keyExpression));var proxy;this.itemName?(proxy=Object.create(context),proxy[this.itemName]=item):(proxy=Object.create(item),proxy.$$=context);var key=item&&this.getKey.call(proxy);if(key)if(observers.hasOwnProperty(key)&&this.removeObserver(observers,key),this.resultExpression){var observer=this.watch(observations,this.resultExpression,map,key,proxy);if(!observer)throw new TypeError("Invalid resultExpression for computed.map");observer.bind(proxy),observers[key]=observer}else map[key]=item},removeItem:function(observations,computedObject,map,observers,context,item){var key=item&&this.getKey.call(item);key&&(this.removeObserver(observers,key),this.removeExpression&&observations.get(context,this.removeExpression),delete map[key])},removeObserver:function(observers,key){var observer=observers[key];observer&&(observer.unbind(),delete observers[key])}})},{"./computed-property":21}],25:[function(require,module,exports){function WhenProperty(whenExpression,thenExpression){thenExpression||(thenExpression=whenExpression,whenExpression="true"),this.whenExpression=whenExpression,this.thenExpression=thenExpression}module.exports=WhenProperty;var ComputedProperty=require("./computed-property");ComputedProperty.extend(WhenProperty,{addTo:function(observations,computedObject,propertyName,context){return this.thenMethod||(this.thenMethod=observations.getExpression(this.thenExpression)),observations.createObserver(this.whenExpression,function(value){if(value){var result=this.thenMethod.call(context);result&&result.then?result.then(function(value){computedObject[propertyName]=value,observations.sync()},function(err){computedObject[propertyName]=void 0,observations.sync()}):computedObject[propertyName]=result}else computedObject[propertyName]=void 0},this)}})},{"./computed-property":21}],26:[function(require,module,exports){function ensureObservers(obj,options){return obj.computedObservers||(Object.defineProperty(obj,"computedObservers",{value:[]}),obj.computedObservers.enabled=!options||options.enabled!==!1,obj.computedObservers.enable=function(){this.enabled||(this.enabled=!0,this.forEach(function(observer){observer.bind(options&&options.context||obj)}))},obj.computedObservers.disable=function(){this.enabled&&(this.enabled=!1,this.forEach(function(observer){observer.unbind(),observer.sync()}))}),obj}var ComputedProperty=require("./computed-properties/computed-property"),ExprProperty=require("./computed-properties/expr"),MapProperty=require("./computed-properties/map"),IfProperty=require("./computed-properties/if"),WhenProperty=require("./computed-properties/when");exports.create=function(observations){function computed(map,options){return computed.extend({},map,options)}return computed.extend=function(obj,map,options){if(!obj||!map)throw new TypeError("computed.extend expects `obj` and `map` to be objects");return ensureObservers(obj,options),Object.keys(map).forEach(function(property){var observer,expression=map[property];"string"==typeof expression?observer=observations.createObserver(expression,function(value){obj[property]=value}):expression&&expression.isComputedProperty?observer=expression.addTo(observations,obj,property,obj):obj[property]=expression,observer&&(obj.computedObservers.push(observer),obj.computedObservers.enabled&&observer.bind(options&&options.context||obj))}),obj},computed.expr=function(expression){return new ExprProperty(expression)},computed.map=function(sourceExpression,keyName,resultExpression,removeExpression){return new MapProperty(sourceExpression,keyName,resultExpression,removeExpression)},computed["if"]=function(ifExpression,thenExpression){return new IfProperty(ifExpression,thenExpression)},computed.when=function(whenExpression,thenExpression){return new WhenProperty(whenExpression,thenExpression)},computed.async=computed.when,computed.ComputedProperty=ComputedProperty,computed}},{"./computed-properties/computed-property":21,"./computed-properties/expr":22,"./computed-properties/if":23,"./computed-properties/map":24,"./computed-properties/when":25}],27:[function(require,module,exports){function ObservableHash(observations){var _observers=[];_observers.enabled=!0,Object.defineProperties(this,{_context:{writable:!0,value:this},_observations:{value:observations},_namespaces:{value:[]},_observers:{value:_observers},computedObservers:{value:_observers}})}module.exports=ObservableHash;var Class=require("chip-utils/class"),deepDelimiter=/(?:\[\]|\{\})\.?/i;Class.extend(ObservableHash,{get observersEnabled(){return this._observers.enabled},set observersEnabled(value){value?this.observersStart():this.observersStop(!0)},observersStart:function(){this._observers.enabled=!0,this._observers.forEach(function(observer){observer.bind(this._context)},this),this._namespaces.forEach(function(namespace){this[namespace].observersResume()},this)},observersStop:function(clearValues){this._observers.enabled=!1,this._observers.forEach(function(observer){observer.unbind(),clearValues&&observer.sync()}),this._namespaces.forEach(function(namespace){this[namespace].observersPause(clearValues)},this)},get:function(expression){return this._observations.get(this._context,expression)},set:function(expression,value){return this._observations.set(this._context,expression,value)},addComputed:function(namespace,map){if("string"==typeof namespace&&"object"==typeof map)return this[namespace]||(this[namespace]=new ObservableHash(this._observations),this[namespace].observersEnabled=this.observersEnabled,this._namespaces.push(namespace)),this._observations.computed.extend(this[namespace],map,{context:this[namespace]._context}),this[namespace];if(namespace&&"object"==typeof namespace)return this._observations.computed.extend(this,namespace,{context:this._context}),this;throw new TypeError("addComputed must have a map object")},watch:function(expression,onChange,callbackContext){var observer=this._observations.createObserver(expression,onChange,callbackContext||this);return this._observers.push(observer),this.observersEnabled&&observer.bind(this._context),observer},track:function(expression,onAdd,onRemove,callbackContext){if(deepDelimiter.test(expression))return this.trackDeeply(expression,onAdd,onRemove,callbackContext);var observer=this._observations.createMemberObserver(expression,onAdd,onRemove,callbackContext||this);return this._observers.push(observer),this.observersEnabled&&observer.bind(this._context),observer},trackDeeply:function(expression,onAdd,onRemove,callbackContext){if(!deepDelimiter.test(expression))return this.track(expression,onAdd,onRemove,callbackContext);var observers=new WeakMap,observations=this._observations,steps=expression.split(deepDelimiter),lastIndex=steps.length-1,removedCallback=function(item){var observer=observers.get(item);observer&&(observer.unbind(),observer.sync(),observers["delete"](item))},addedCallbacks=steps.slice(1,-1).map(function(expr,index){return function(item){if(item){var observer=observations.observeMembers(expr||"this",addedCallbacks[index+1],removedCallbacks[index+1],callbackContext);return observers.set(item,observer),observer.bind(item),observer}}}),removedCallbacks=steps.map(function(){return removedCallback});steps[lastIndex]?addedCallbacks.push(function(item,key){if(item){var observer=observations.createObserver(steps[lastIndex],function(value,oldValue){null!=oldValue&&"function"==typeof onRemove&&onRemove.call(callbackContext,oldValue,key),null!=value&&"function"==typeof onAdd&&onAdd.call(callbackContext,value,key)});return observers.set(item,observer),observer.bind(item),observer}}):(addedCallbacks.push(onAdd),removedCallbacks[lastIndex]=onRemove);var observer=observations.observeMembers(steps[0],addedCallbacks[0],removedCallbacks[0],callbackContext);return this._observers.push(observer),this.observersEnabled&&observer.bind(this._context),observer}})},{"chip-utils/class":1}],28:[function(require,module,exports){(function(global){function Observations(){Object.getOwnPropertyNames(this.constructor.prototype).forEach(function(name){"function"==typeof this[name]&&(this[name]=this[name].bind(this))},this),this.globals={},this.formatters={},this.observers=[],this.callbacks=[],this.listeners=[],this.syncing=!1,this.callbacksRunning=!1,this.rerun=!1,this.cycles=0,this.maxCycles=10,this.timeout=null,this.pendingSync=null,this.computed=computed.create(this),this.expressions=expressions}module.exports=Observations;var Class=require("chip-utils/class"),Observer=require("./observer"),computed=require("./computed"),ObservableHash=require("./observable-hash"),expressions=require("expressions-js"),requestAnimationFrame=global.requestAnimationFrame||setTimeout,cancelAnimationFrame=global.cancelAnimationFrame||clearTimeout;Class.extend(Observations,{ObservableHash:ObservableHash,createHash:function(computedMap){var hash=new ObservableHash(this);return computedMap&&hash.addComputed(computedMap),hash},watch:function(context,expression,onChange,callbackContext){var observer=this.createObserver(expression,onChange,callbackContext||context);return observer.bind(context),observer},observe:function(context,expression,onChange,callbackContext){return this.watch(context,expression,onChange,callbackContext)},track:function(context,expression,onAdd,onRemove,callbackContext){var observer=this.createMemberObserver(expression,onAdd,onRemove,callbackContext);return observer.bind(context),observer},observeMembers:function(expression,onAdd,onRemove,callbackContext){return this.createMemberObserver(expression,onAdd,onRemove,callbackContext)},createObserver:function(expression,callback,callbackContext){return new Observer(this,expression,callback,callbackContext)},createMemberObserver:function(expression,onAdd,onRemove,callbackContext){onAdd||(onAdd=function(){}),onRemove||(onRemove=function(){});var observer=this.createObserver(expression,function(source,oldValue,changes){changes?(changes.forEach(function(change){"splice"===change.type?change.removed.forEach(function(item,index){onRemove(item,index+change.index)},callbackContext):null!=change.oldValue&&onRemove.call(callbackContext,change.oldValue,change.name)}),changes.forEach(function(change){if("splice"===change.type)source.slice(change.index,change.index+change.addedCount).forEach(function(item,index){onAdd(item,index+change.index,source)},callbackContext);else{var value=source[change.name];null!=value&&onAdd.call(callbackContext,value,change.name,source)}})):Array.isArray(source)?source.forEach(onAdd,callbackContext):source&&"object"==typeof source?Object.keys(source).forEach(function(key){var value=source[key];null!=value&&onAdd.call(callbackContext,value,key,source)}):Array.isArray(oldValue)?oldValue.forEach(onRemove,callbackContext):oldValue&&"object"==typeof oldValue&&Object.keys(oldValue).forEach(function(key){var value=oldValue[key];null!=value&&onRemove.call(callbackContext,value,key,oldValue)})});return observer.getChangeRecords=!0,observer},getExpression:function(expression,options){if(options&&options.isSetter)return expressions.parseSetter(expression,this.globals,this.formatters,options.extraArgs);if(options&&options.extraArgs){var allArgs=[expression,this.globals,this.formatters].concat(options.extraArgs);return expressions.parse.apply(expressions,allArgs)}return expressions.parse(expression,this.globals,this.formatters)},get:function(context,expression){return this.getExpression(expression).call(context)},set:function(source,expression,value){return this.getExpression(expression,{isSetter:!0}).call(source,value)},sync:function(callback){return"function"==typeof callback&&this.afterSync(callback),this.pendingSync?!1:(this.pendingSync=requestAnimationFrame(this.syncNow),!0)},syncNow:function(callback){return"function"==typeof callback&&this.afterSync(callback),cancelAnimationFrame(this.pendingSync),this.pendingSync=null,this.syncing?(this.rerun=!0,!1):(this.runSync(),!0)},runSync:function(){this.syncing=!0,this.rerun=!0,this.cycles=0;for(var i,l;this.rerun;){if(++this.cycles===this.maxCycles)throw new Error("Infinite observer syncing, an observer is calling Observer.sync() too many times");for(this.rerun=!1,i=0;i<this.observers.length;i++)this.observers[i].sync()}this.callbacksRunning=!0;var callbacks=this.callbacks;for(this.callbacks=[];callbacks.length;)callbacks.shift()();for(i=0,l=this.listeners.length;l>i;i++){var listener=this.listeners[i];listener()}this.callbacksRunning=!1,this.syncing=!1,this.cycles=0},afterSync:function(callback){if("function"!=typeof callback)throw new TypeError("callback must be a function");this.callbacksRunning&&this.sync(),this.callbacks.push(callback)},onSync:function(listener){if("function"!=typeof listener)throw new TypeError("listener must be a function");this.listeners.push(listener)},offSync:function(listener){if("function"!=typeof listener)throw new TypeError("listener must be a function");var index=this.listeners.indexOf(listener);-1!==index&&this.listeners.splice(index,1).pop()},add:function(observer,skipUpdate){this.observers.push(observer),skipUpdate||(observer.forceUpdateNextSync=!0,observer.sync())},remove:function(observer){var index=this.observers.indexOf(observer);return-1!==index?(this.observers.splice(index,1),!0):!1}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./computed":26,"./observable-hash":27,"./observer":29,"chip-utils/class":1,"expressions-js":4}],29:[function(require,module,exports){function Observer(observations,expression,callback,callbackContext){"function"==typeof expression?(this.getter=expression,this.setter=expression):this.getter=expressions.parse(expression,observations.globals,observations.formatters),this.observations=observations,this.expression=expression,this.callback=callback,this.callbackContext=callbackContext,this.getChangeRecords=!1,this.skip=!1,this.forceUpdateNextSync=!1,this.context=null,this.oldValue=void 0}module.exports=Observer;var Class=require("chip-utils/class"),expressions=require("expressions-js"),diff=require("differences-js");Class.extend(Observer,{get getChangeRecords(){return this._getChangeRecords},set getChangeRecords(value){this._getChangeRecords=Boolean(value),value&&this.oldValue&&(this.oldValue=diff.clone(this.oldValue))},bind:function(context,skipUpdate){this.context=context,this.callback&&this.observations.add(this,skipUpdate)},unbind:function(){this.observations.remove(this),this.context=null},close:function(){this.unbind(),this.callback=null,this.callbackContext=null},get:function(){return this.context?this.getter.call(this.context):void 0},set:function(value){if(this.context&&this.setter!==!1){if(!this.setter){try{this.setter="string"==typeof this.expression?expressions.parseSetter(this.expression,this.observations.globals,this.observations.formatters):!1}catch(e){this.setter=!1}if(!this.setter)return}try{var result=this.setter.call(this.context,value)}catch(e){return}return this.sync(),this.observations.sync(),result}},skipNextSync:function(){this.skip=!0},sync:function(){var value=this.get();if(this.skip||!this.callback)this.skip=!1,this.getChangeRecords?this.oldValue=diff.clone(value):this.oldValue=value;else{var useCompareBy=this.getChangeRecords&&this.compareBy&&Array.isArray(value)&&Array.isArray(this.oldValue);if(useCompareBy){var compareExpression=this.compareBy,name=this.compareByName,index=this.compareByIndex||"__index__",ctx=this.context,globals=this.observations.globals,formatters=this.observations.formatters,oldValue=this.oldValue;name||(name="__item__",compareExpression=name+"."+compareExpression);var getCompareValue=expressions.parse(compareExpression,globals,formatters,name,index);changed=diff.values(value.map(getCompareValue,ctx),oldValue.map(getCompareValue,ctx))}else this.getChangeRecords?changed=diff.values(value,this.oldValue):changed=diff.basic(value,this.oldValue);var oldValue=this.oldValue;if(this.getChangeRecords?this.oldValue=diff.clone(value):this.oldValue=value,!changed&&!this.forceUpdateNextSync)return;this.forceUpdateNextSync=!1,Array.isArray(changed)?this.callback.call(this.callbackContext,value,oldValue,changed):this.callback.call(this.callbackContext,value,oldValue)}}})},{"chip-utils/class":1,"differences-js":2,"expressions-js":4}]},{},[9])(9)});