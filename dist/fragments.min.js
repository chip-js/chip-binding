!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.fragments=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function registerBinder(name,binder){return"function"==typeof binder&&(binder={updated:binder}),name.indexOf("*")>=0&&(binder.expr=new RegExp("^"+escapeRegExp(name).replace("\\*","(.*)")+"$"),wildcards.push(binder),wildcards.sort(binderSort)),registeredBinders[name]=binder,binder}function unregisterBinder(name){var binder=getBinder(name);if(binder)return name.indexOf("*")>=0&&wildcards.splice(wildcards.indexOf(binder),1),delete registeredBinders[name],binder}function getBinder(name){return registeredBinders.hasOwnProperty(name)?registeredBinders[name]:void 0}function findBinder(name){var binder=getBinder(name);return binder||wildcards.some(function(binder){return(binder=binder.expr.test(name))?!0:void 0}),binder&&binder.onlyWhenBound&&!isBound(value)?void 0:(!binder&&isBound(value)&&(binder=getBinder("{{attribute}}")),binder)}function createBinding(binder,options){return Object.keys(binder).forEach(function(key){options[key]=binder[key]}),new Binding(options,!0)}function escapeRegExp(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function isBound(text){return boundExpr.test(text)}function binderSort(a,b){return b.priority-a.priority}var Binding=require("./binding"),registeredBinders={},wildcards=[];registerBinder("{{text}}",function(value){this.element.textContent=null!=value?value:""}),registerBinder("{{attribute}}",function(value){null!=value?element.setAttribute(this.name,value):element.removeAttribute(this.name)}),exports.register=registerBinder,exports.unregister=unregisterBinder,exports.get=getBinder,exports.find=findBinder,exports.createBinding=createBinding;var boundExpr=/{{(.*?)}}/g},{"./binding":3}],2:[function(require,module,exports){function wrapIfExp(expr,isUnless){return(isUnless?"!":"")+expr}var Binder=require("./binder"),Template=require("./template");Binder.register("debug",{priority:200,udpated:function(value){console.info("Debug:",this.expression,"=",value)}}),Binder.register("html",function(value){element.innerHTML=null==value?"":value}),Binder.register("class-*",function(value){value?this.element.classList.add(this.match):this.element.classList.remove(this.match)}),Binder.register("value",{onlyWhenBound:!0,compiled:function(){var name=this.element.tagName.toLowerCase(),type=this.element.type;this.input=inputMethods[type]||inputMethods[name]||inputMethods.radiogroup,this.element.hasAttribute("value-events")?(this.events=this.element.getAttribute("value-events").split(" "),this.element.removeAttribute("value-events")):"option"!==name&&(this.events=["change"]),this.element.hasAttribute("value-field")&&(this.valueField=this.element.getAttribute("value-field"),this.element.removeAttribute("value-field")),"option"===type&&(this.valueField=this.element.parentNode.valueField)},created:function(){function onChange(){input.get(valueField)===observer.oldValue||element.readOnly||observer.set(input.get(valueField))}if(this.events){var element=this.element,observer=this.observer,input=this.input,valueField=this.valueField;"text"===element.type&&element.addEventListener("keydown",function(event){13===event.keyCode&&onChange()}),this.events.forEach(function(event){element.addEventListener(event,onChange)})}},updated:function(value){this.input.get(this.valueField)!=value&&this.input.set(value,this.valueField)}});var defaultInputMethod={get:function(){return this.value},set:function(value){this.value=value}},inputMethods={checkbox:{get:function(){return this.checked},set:function(value){this.checked=!!value}},file:{get:function(){return this.files&&this.files[0]},set:function(value){}},select:{get:function(valueField){return valueField?this.options[this.selectedIndex].valueObject:this.value},set:function(value,valueField){valueField?(this.valueObject=value,this.value=value[valueField]):this.value=value}},option:{get:function(valueField){return valueField?this.valueObject[valueField]:this.value},set:function(value,valueField){valueField?(this.valueObject=value,this.value=value[valueField]):this.value=value}},input:defaultInputMethod,textarea:defaultInputMethod,radiogroup:{get:function(){return this.find('input[type="radio"][checked]').value},set:function(value){this.querySelector('input[type="radio"][checked]').checked=!1;var radio=this.querySelector('input[type="radio"][value="'+value.replace(/"/g,'\\"')+'"]');radio&&(radio.checked=!0)}}};Binder.register("on-*",{created:function(){var eventName=this.match,_this=this;this.element.addEventListener(eventName,function(event){if(event instanceof CustomEvent||event.preventDefault(),!element.hasAttribute("disabled")){var listener=_this.observer.get();listener&&listener.call(this,event)}})}}),Binder.register("native-*",{created:function(){var eventName=this.match,_this=this;this.element.addEventListener(eventName,function(event){var listener=_this.observer.get();listener&&listener.call(this,event)})}});var keyCodes={enter:13,esc:27,"ctrl-enter":13};Object.keys(keyCodes).forEach(function(name){var keyCode=keyCodes[name];Binder.register("on-"+name,{created:function(){var useCtrlKey=0===this.match.indexOf("ctrl-"),_this=this;this.element.addEventListener("keydown",function(event){if((!useCtrlKey||event.ctrlKey||event.metaKey)&&event.keyCode===keyCode&&(event.preventDefault(),!element.hasAttribute("disabled"))){var listener=_this.observer.get();listener&&listener.call(this,event)}})}})}),Binder.register("*$",function(value){var attrName=this.match;value?this.element.setAttribute(attrName,value):this.element.removeAttribute(attrName)}),Binder.register("*?",function(value){var attrName=this.match;value?this.element.setAttribute(attrName,value):this.element.removeAttribute(attrName)}),Binder.register("checked?",Binder.get("value")),Binder.register("if",{priority:50,compiled:function(){var element=this.element,expressions=[wrapIfExp(this.expression,"unless"===this.name)],placeholder=document.createTextNode(""),node=element.nextElementSibling;for(this.element=placeholder,element.parentNode.replaceChild(placeholder,element),this.templates=[Template.createTemplate(element)];node;){var expression,next=node.nextElementSibling;if(node.hasAttribute("else-if"))expression=this.codify(node.getAttribute("else-if")),expressions.push(wrapIfExp(expression,!1)),node.removeAttribute("else-if");else if(node.hasAttribute("else-unless"))expression=this.codify(node.getAttribute("else-unless")),expressions.push(wrapIfExp(expression,!0)),node.removeAttribute("else-unless");else{if(!node.hasAttribute("else"))break;node.removeAttribute("else"),next=null}node.remove(),this.templates.push(Template.createTemplate(node)),node=next}this.expression=expressions.map(function(expr,index){return expr+" ? "+index+" : "}).join("")+expressions.length},updated:function(index){this.showing&&(this.showing.dispose(),this.showing=null);var template=this.templates[index];template&&(this.showing=template.createView(),this.showing.bind(this.context),this.element.parentNode.insertBefore(this.showing,this.element.nextSibling))}}),Binder.register("unless",Binder.get("if")),Binder.register("each",{priority:100,compiled:function(){var parent=this.element.parentNode,placeholder=document.createTextNode("");parent.insertBefore(placeholder,this.element),this.template=Template.createTemplate(this.element),this.element=placeholder;var parts=this.expression.split(/\s+in\s+/);this.expression=parts.pop();var key=parts.pop();key&&(parts=key.split(/\s*,\s*/),this.valueName=parts.pop(),this.keyName=parts.pop())},created:function(){this.views=[]},updated:function(value,oldValue,changes){changes?this.updateChanges(value,changes):this.populate(value)},createView:function(key,value){var view=this.template.createView(),context=value;return this.valueName&&(context=Object.create(this.context),this.keyName&&(context[this.keyName]=key),context[this.valueName]=value),view.bind(context),view._eachItem_=value,view},populate:function(value){if(this.views.length&&(this.views.forEach(function(node){node.dispose()}),this.views.length=0),Array.isArray(value)&&value.length&&value.forEach(function(item,index){this.views.push(this.createView(index,item))},this),this.views.length){var frag=document.createDocumentFragment();this.views.forEach(function(elem){frag.appendChild(elem)}),this.element.parentNode.insertBefore(frag,this.element.nextSibling)}},updateChanges:function(value,changes){var removedCount=0,removedMap=new Map;changes.forEach(function(splice){if(splice.removed.length){var removed=this.views.splice(splice.index-removedCount,splice.removed.length);removed.forEach(function(view){removedMap.set(view._eachItem_,view),view.remove()}),removedCount+=removed.length}},this),changes.forEach(function(splice){if(splice.addedCount){for(var newViews=[],frag=document.createDocumentFragment(),index=splice.index,i=(splice.addedCount,index);i<addedCount;i++){var item=value[i],view=removedMap.get(item);view?(removedMap["delete"](item),this.keyName&&(view.context[this.keyName]=i)):view=this.createView(i,item),newViews.push(view),frag.appendChild(view)}this.views.splice.apply(this.views,[index,0].concat(newViews));var previousView=this.views[index-1],nextSibling=previousView?previousView.lastViewNode.nextSibling:this.element.nextSibling;nextSibling.parentNode.insertBefore(frag,nextSibling)}},this),removedMap.forEach(function(value){value._eachItem_=null,value.dispose()}),removedMap.clear()}})},{"./binder":1,"./template":10}],3:[function(require,module,exports){function Binding(options,isTemplate){if(!options.element||!options.view)throw new TypeError("A binding must receive an element and a view");Object.keys(options).forEach(function(key){this[key]=options[key]},this),this.elementPath||(this.elementPath=initNodePath(this.element,this.view)),this.context=null,isTemplate?this.compiled():(this.expression&&(this.observer=new Binding.Observer(this.expression,this.updated,this)),this.created())}function initNodePath(node,view){for(var path=[];node!==view;){var parent=node.parentNode;path.unshift(indexOf.call(parent.childNodes,node)),node=parent}return path}module.exports=Binding,Binding.Observer=require("./observer"),Expression=require("./expression"),Binding.prototype={get camelCase(){return(this.match||this.name||"").replace(/-+(\w)/g,function(_,char){return char.toUpperCase()})},bind:function(context){this.context=context,this.observer&&this.observer.bind(context),this.attached()},unbind:function(){this.context=null,this.observer&&this.observer.unbind(),this.detached()},compiled:function(){},created:function(){},updated:function(){},attached:function(){},detached:function(){},codify:function(text){return Expression.codify(text)}};var indexOf=Array.prototype.indexOf},{"./expression":5,"./observer":9}],4:[function(require,module,exports){var diff=exports;!function(){function ChangeRecord(object,type,name,oldValue){this.object=object,this.type=type,this.name=name,this.oldValue=oldValue}function Splice(index,removed,addedCount){this.index=index,this.removed=removed,this.addedCount=addedCount}function clone(value,deep){if(Array.isArray(value))return deep?value.map(function(value){return clone(value,deep)}):value.slice();if(value&&"object"==typeof value){if(value.valueOf()!==value)return new value.constructor(value.valueOf());var copy={};for(var key in value){var objValue=value[key];deep&&(objValue=clone(objValue,deep)),copy[key]=objValue}return copy}return value}function diffValues(value,oldValue){if(Array.isArray(value)&&Array.isArray(oldValue)){var splices=diffArrays(value,oldValue);return splices.length?splices:!1}if(value&&oldValue&&"object"==typeof value&&"object"==typeof oldValue){var valueValue=value.valueOf(),oldValueValue=oldValue.valueOf();if("object"!=typeof valueValue&&"object"!=typeof oldValueValue)return valueValue!==oldValueValue;var changeRecords=diffObjects(value,oldValue);return changeRecords.length?changeRecords:!1}return diffBasic(value,oldValue)}function diffBasic(value,oldValue){if(value&&oldValue&&"object"==typeof value&&"object"==typeof oldValue){var valueValue=value.valueOf(),oldValueValue=oldValue.valueOf();if("object"!=typeof valueValue&&"object"!=typeof oldValueValue)return diffBasic(valueValue,oldValueValue)}return"number"==typeof value&&"number"==typeof oldValue&&isNaN(value)&&isNaN(oldValue)?!1:value!==oldValue}function diffObjects(object,oldObject){var prop,oldValue,value,changeRecords=[];for(prop in oldObject)oldValue=oldObject[prop],value=object[prop],(void 0===value||diffBasic(value,oldValue))&&(prop in object?diffBasic(value,oldValue)&&changeRecords.push(new ChangeRecord(object,"updated",prop,oldValue)):changeRecords.push(new ChangeRecord(object,"deleted",prop,oldValue)));for(prop in object)value=object[prop],prop in oldObject||changeRecords.push(new ChangeRecord(object,"new",prop));return Array.isArray(object)&&object.length!==oldObject.length&&changeRecords.push(new ChangeRecord(object,"updated","length",oldObject.length)),changeRecords}function diffArrays(value,oldValue){var currentStart=0,currentEnd=value.length,oldStart=0,oldEnd=oldValue.length,minLength=Math.min(currentEnd,oldEnd),prefixCount=sharedPrefix(value,oldValue,minLength),suffixCount=sharedSuffix(value,oldValue,minLength-prefixCount);if(currentStart+=prefixCount,oldStart+=prefixCount,currentEnd-=suffixCount,oldEnd-=suffixCount,currentEnd-currentStart===0&&oldEnd-oldStart===0)return[];if(currentStart===currentEnd)return[new Splice(currentStart,oldValue.slice(oldStart,oldEnd),0)];if(oldStart===oldEnd)return[new Splice(currentStart,[],currentEnd-currentStart)];for(var distances=calcEditDistances(value,currentStart,currentEnd,oldValue,oldStart,oldEnd),ops=spliceOperationsFromEditDistances(distances),splice=null,splices=[],index=currentStart,oldIndex=oldStart,i=0,l=ops.length;l>i;i++){var op=ops[i];op===EDIT_LEAVE?(splice&&(splices.push(splice),splice=null),index++,oldIndex++):op===EDIT_UPDATE?(splice||(splice=new Splice(index,[],0)),splice.addedCount++,index++,splice.removed.push(oldValue[oldIndex]),oldIndex++):op===EDIT_ADD?(splice||(splice=new Splice(index,[],0)),splice.addedCount++,index++):op===EDIT_DELETE&&(splice||(splice=new Splice(index,[],0)),splice.removed.push(oldValue[oldIndex]),oldIndex++)}return splice&&splices.push(splice),splices}function sharedPrefix(current,old,searchLength){for(var i=0;searchLength>i;i++)if(diffBasic(current[i],old[i]))return i;return searchLength}function sharedSuffix(current,old,searchLength){for(var index1=current.length,index2=old.length,count=0;searchLength>count&&!diffBasic(current[--index1],old[--index2]);)count++;return count}function spliceOperationsFromEditDistances(distances){for(var i=distances.length-1,j=distances[0].length-1,current=distances[i][j],edits=[];i>0||j>0;)if(0!==i)if(0!==j){var northWest=distances[i-1][j-1],west=distances[i-1][j],north=distances[i][j-1];north>west?min=northWest>west?west:northWest:min=northWest>north?north:northWest,min===northWest?(northWest===current?edits.push(EDIT_LEAVE):(edits.push(EDIT_UPDATE),current=northWest),i--,j--):min===west?(edits.push(EDIT_DELETE),i--,current=west):(edits.push(EDIT_ADD),j--,current=north)}else edits.push(EDIT_DELETE),i--;else edits.push(EDIT_ADD),j--;return edits.reverse(),edits}function calcEditDistances(current,currentStart,currentEnd,old,oldStart,oldEnd){var i,j,rowCount=oldEnd-oldStart+1,columnCount=currentEnd-currentStart+1,distances=new Array(rowCount);for(i=0;rowCount>i;i++)distances[i]=new Array(columnCount),distances[i][0]=i;for(j=0;columnCount>j;j++)distances[0][j]=j;for(i=1;rowCount>i;i++)for(j=1;columnCount>j;j++)if(diffBasic(current[currentStart+j-1],old[oldStart+i-1])){var north=distances[i-1][j]+1,west=distances[i][j-1]+1;distances[i][j]=west>north?north:west}else distances[i][j]=distances[i-1][j-1];return distances}diff.clone=clone,diff.values=diffValues,diff.basic=diffBasic,diff.objects=diffObjects,diff.arrays=diffArrays,EDIT_LEAVE=0,EDIT_UPDATE=1,EDIT_ADD=2,EDIT_DELETE=3}()},{}],5:[function(require,module,exports){function codifyExpression(text){return oneBoundExpr.test(text)?text.replace(oneBoundExpr,"$1"):(text='"'+text.replace(boundExpr,function(match,text){return'" + ('+text+') + "'})+'"',text.replace(/^"" \+ | "" \+ | \+ ""$/g,""))}function getExpression(expr,options){options||(options={}),options.args||(options.args=[]);var cacheKey=expr+"|"+options.args.join(","),func=expression.cache[cacheKey];if(func)return func;options.args.unshift("_formatters_");var body=parseExpression(expr,options);try{func=expression.cache[cacheKey]=Function.apply(null,options.args.concat(body))}catch(e){if(options.ignoreErrors)return;throw console.error("Bad expression:\n`"+expr+"`\nCompiled expression:\n"+body),new Error(e.message)}return func}function getSetter(expr,options){return options||(options={}),options.args=["value"],expr=expr.replace(/(\s*\||$)/," = value$1"),getExpression(expr,options)}function bindExpression(expr,scope,options){return getExpression(expr,options).bind(scope)}function parseExpression(expr,options){return initParse(expr,options),expr=pullOutStrings(expr),expr=parseFormatters(expr),expr=parseExpr(expr),expr="return "+expr,expr=putInStrings(expr),expr=addReferences(expr)}function initParse(expr,options){referenceCount=currentReference=0,ignore=expression.globals.concat(options.globals||[],options.args||[]),strings.length=0}function pullOutStrings(expr){return expr.replace(quoteExpr,function(str,quote){return strings.push(str),quote+quote})}function putInStrings(expr){return expr.replace(emptyQuoteExpr,function(){return strings.shift()})}function addReferences(expr){if(referenceCount){for(var refs=[],i=1;referenceCount>=i;i++)refs.push("_ref"+i);expr="var "+refs.join(", ")+";\n"+expr}return expr}function parseFormatters(expr){if(expr=expr.replace(pipeExpr,function(match,orIndicator){return orIndicator?match:"@@@"}),formatters=expr.split(/\s*@@@\s*/),expr=formatters.shift(),!formatters.length)return expr;var setter="";if(value=expr,setterExpr.test(expr)){var parts=expr.split(setterExpr);setter=parts[0]+" = ",value=parts[1]}return formatters.forEach(function(formatter){var match=formatter.trim().match(formatterExpr);if(!match)throw new Error("Formatter is invalid: "+formatter);var formatterName=match[1],args=match[2].split(argSeparator);args.unshift(value),setter&&args.push(!0),value="_formatters_."+formatterName+".call(this, "+args.join(", ")+")"}),setter+value}function parseExpr(expr){if(setterExpr.test(expr)){var parts=expr.split(" = "),setter=parts[0],value=parts[1],negate="";return"!"===setter.charAt(0)&&(negate="!",setter=setter.slice(1)),setter=parsePropertyChains(setter).replace(/^\(|\)$/g,"")+" = ",value=parsePropertyChains(value),setter+negate+value}return parsePropertyChains(expr)}function parsePropertyChains(expr){var js,javascript="",previousIndexes=[currentIndex,propExpr.lastIndex];for(currentIndex=0,propExpr.lastIndex=0;(js=nextChain(expr))!==!1;)javascript+=js;return currentIndex=previousIndexes[0],propExpr.lastIndex=previousIndexes[1],javascript}function nextChain(expr){if(finishedChain)return finishedChain=!1;var match=propExpr.exec(expr);if(!match)return finishedChain=!0,expr.slice(currentIndex);var prefix=match[1],objIndicator=match[2],propChain=match[3],postfix=match[4],colonOrParen=match[5];match=match[0];var skipped=expr.slice(currentIndex,propExpr.lastIndex-match.length);return currentIndex=propExpr.lastIndex,objIndicator&&":"===colonOrParen?skipped+match:skipped+parseChain(prefix,propChain,postfix,colonOrParen,expr)}function splitLinks(chain){for(var match,index=0,parts=[];match=chainLinks.exec(chain);)1!==chainLinks.lastIndex&&(parts.push(chain.slice(index,chainLinks.lastIndex-1)),index=chainLinks.lastIndex-1);return parts.push(chain.slice(index)),parts}function addThis(chain){return-1===ignore.indexOf(chain.split(chainLink).shift())?"this."+chain:chain}function parseChain(prefix,propChain,postfix,paren,expr){continuation="."===prefix,continuation&&(propChain="."+propChain,prefix="");var links=splitLinks(propChain),newChain="";return 1!==links.length||continuation||paren?(continuation||(newChain="("),links.forEach(function(link,index){index!==links.length-1?newChain+=parsePart(link,index):parens[paren]?(postfix=postfix.replace(paren,""),newChain+=parseFunction(link,index,expr)):newChain+="_ref"+currentReference+link+")"})):(link=links[0],newChain=addThis(link)),prefix+newChain+postfix}function parseFunction(link,index,expr){var call=getFunctionCall(expr);link+=call.slice(0,1)+"~~insideParens~~"+call.slice(-1);var insideParens=call.slice(1,-1);"."===expr.charAt(propExpr.lastIndex)?link=parsePart(link,index):0===index?(link=parsePart(link,index),link+="_ref"+currentReference+")"):link="_ref"+currentReference+link+")";var ref=currentReference;return link=link.replace("~~insideParens~~",parsePropertyChains(insideParens)),currentReference=ref,link}function getFunctionCall(expr){for(var startIndex=propExpr.lastIndex,open=expr.charAt(startIndex-1),close=parens[open],endIndex=startIndex-1,parenCount=1;endIndex++<expr.length;){var ch=expr.charAt(endIndex);if(ch===open?parenCount++:ch===close&&parenCount--,0===parenCount)break}return currentIndex=propExpr.lastIndex=endIndex+1,open+expr.slice(startIndex,endIndex)+close}function parsePart(part,index){0!==index||continuation?part="_ref"+currentReference+part:-1===ignore.indexOf(part.split(/\.|\(|\[/).shift())&&(part="this."+part),currentReference=++referenceCount;var ref="_ref"+currentReference;return"("+ref+" = "+part+") == null ? undefined : "}var expression=exports;expression.cache={},expression.globals=["true","false","null","undefined","window","this"],expression.codify=codifyExpression,expression.get=getExpression,expression.getSetter=getSetter,expression.bind=bindExpression;var oneBoundExpr=/^{{(.*?)}}$/,boundExpr=/{{(.*?)}}/g,quoteExpr=/(['"\/])(\\\1|[^\1])*?\1/g,emptyQuoteExpr=/(['"\/])\1/g,pipeExpr=/\|(\|)?/g,formatterExpr=/^([^\(]+)(?:\((.*)\))?$/,argSeparator=/\s*,\s*/g,propExpr=/((\{|,|\.)?\s*)([a-z$_\$](?:[a-z_\$0-9\.-]|\[['"\d]+\])*)(\s*(:|\(|\[)?)/gi,chainLinks=/\.|\[/g,chainLink=/\.|\[|\(/,setterExpr=/\s=\s/,ignore=null,strings=[],referenceCount=0,currentReference=0,currentIndex=0,finishedChain=!1,continuation=!1,parens={"(":")","[":"]"}},{}],6:[function(require,module,exports){function registerFormatter(name,formatter){formatters[name]=formatter}function unregisterFormatter(name,formatter){delete formatters[name]}function getFormatter(name){return formatters[name]}exports.register=registerFormatter,exports.unregister=unregisterFormatter,exports.get=getFormatter;var formatters=exports.formatters={}},{}],7:[function(require,module,exports){function escapeHTML(value){return div.textContent=value||"",div.innerHTML}Formatter=require("./formatter"),Formatter.register("tokenList",function(value){if(Array.isArray(value))return value.join(" ");if(value&&"object"==typeof value){var classes=[];return Object.keys(value).forEach(function(className){value[className]&&classes.push(className)}),classes.join(" ")}return value||""}),Formatter.register("styles",function(value){if(Array.isArray(value))return value.join(" ");if(value&&"object"==typeof value){var classes=[];return Object.keys(value).forEach(function(className){value[className]&&classes.push(className)}),classes.join(" ")}return value||""}),Formatter.register("filter",function(value,filterFunc){return Array.isArray(value)?filterFunc?("function"==typeof filterFunc?value=value.filter(filterFunc,this):Array.isArray(filterFunc)?filterFunc.forEach(function(func){value=value.filter(func,this)}):"object"==typeof filterFunc&&Object.keys(filterFunc).forEach(function(key){var func=filterFunc[key];"function"==typeof func&&(value=value.filter(func,this))}),value):value:[]}),Formatter.register("map",function(value,mapFunc){return null==value||"function"!=typeof mapFunc?value:Array.isArray(value)?value.map(mapFunc,this):mapFunc.call(this,value)}),Formatter.register("reduce",function(value,reduceFunc,initialValue){return null==value||"function"!=typeof mapFunc?value:Array.isArray(value)?3===arguments.length?value.reduce(reduceFunc,initialValue):value.reduce(reduceFunc):3===arguments.length?reduceFunc(initialValue,value):void 0}),Formatter.register("slice",function(value,index,endIndex){return Array.isArray(value)?value.slice(index,endIndex):value}),Formatter.register("date",function(value){return value?(value instanceof Date||(value=new Date(value)),isNaN(value.getTime())?"":value.toLocaleString()):""}),Formatter.register("log",function(value,prefix){return null==prefix&&(prefix="Log:"),console.log(prefix,value),value}),Formatter.register("limit",function(value,limit){return value&&"function"==typeof value.slice?0>limit?value.slice(limit):void value.slice(0,limit):value}),Formatter.register("sort",function(value,sortFunc,dir){if(!sortFunc||!Array.isArray(value))return value;if(dir="desc"===dir?-1:1,"string"==typeof sortFunc){var parts=sortFunc.split(":"),prop=parts[0],dir2=parts[1];dir2="desc"===dir2?-1:1,dir=dir||dir2;var sortFunc=function(a,b){return a[prop]>b[prop]?dir:a[prop]<b[prop]?-dir:0}}else if(-1===dir){var origFunc=sortFunc;sortFunc=function(a,b){return-origFunc(a,b)}}return value.slice().sort(sortFunc)}),Formatter.register("addQuery",function(value,queryField,queryValue){var url=value||location.href,parts=url.split("?");url=parts[0];var query=parts[1],addedQuery="";if(null!=queryValue&&(addedQuery=queryField+"="+encodeURIComponent(queryValue)),query){var expr=new RegExp("\\b"+queryField+"=[^&]*");expr.test(query)?query=query.replace(expr,addedQuery):addedQuery&&(query+="&"+addedQuery)}else query=addedQuery;return query&&(url+="?"+query),url});var div=document.createElement("div");Formatter.register("escape",escapeHTML),Formatter.register("p",function(value){var lines=(value||"").split(/\r?\n/),escaped=lines.map(function(line){return escapeHTML(line)||"<br>"});return"<p>"+escaped.join("</p><p>")+"</p>"}),Formatter.register("br",function(value){var lines=(value||"").split(/\r?\n/);return lines.map(escapeHTML).join("<br>")}),Formatter.register("newline",function(value){var paragraphs=(value||"").split(/\r?\n\s*\r?\n/),escaped=paragraphs.map(function(paragraph){var lines=paragraph.split(/\r?\n/);return lines.map(escapeHTML).join("<br>")});return"<p>"+escaped.join("</p><p>")+"</p>"});var urlExp=/(^|\s|\()((?:https?|ftp):\/\/[\-A-Z0-9+\u0026@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~(_|])/gi;Formatter.register("autolink",function(value,target){return target=target?' target="_blank"':"",(""+value).replace(/<[^>]+>|[^<]+/g,function(match){return"<"===match.charAt(0)?match:match.replace(urlExp,'$1<a href="$2"'+target+">$2</a>")})}),Formatter.register("int",function(value){return value=parseInt(value),isNaN(value)?null:value}),Formatter.register("float",function(value){return value=parseFloat(value),isNaN(value)?null:value}),Formatter.register("bool",function(value){return value&&"0"!==value&&"false"!==value})},{"./formatter":6}],8:[function(require,module,exports){function compileTemplate(template){var previous,walker=document.createTreeWalker(template,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT),bindings=[];template.bindings=bindings,walker.nextNode(),walker.previousNode();do{var node=walker.currentNode,parentNode=node.parentNode;bindings.push.apply(bindings,getBindingsForNode(node,template)),node.parentNode!==parentNode&&previous&&(walker.currentNode=previous,walker.nextNode(),(walker.currentNode.nodeType!==Node.TEXT_NODE||""!==walker.currentNode.nodeValue)&&walker.previousNode()),previous=walker.currentNode}while(walker.nextNode())}function initializeView(view){view.template?view.bindings=view.template.bindings.map(function(binding){return cloneBinding(binding,view)}):compileTemplate(view)}function cleanupView(view){view.unbind()}function bindView(context){this.bindings.forEach(function(binding){binding.bind(context)})}function unbindView(){this.bindings.forEach(function(binding){binding.unbind()})}function getBindingsForNode(node,view){function createBinding(binder,options){return options.element=node,options.view=view,Binder.createBinding(binder,options)}var attr,i,bindings=[];if(node.nodeType===Node.TEXT_NODE){if(splitTextNode(node),isBound(node.nodeValue)){var binder=Binder.find("{{text}}"),expr=Expression.codify(node.nodeValue),binding=createBinding(binder,{expression:expr});bindings.push(binding),node.nodeValue=""}}else{var bound=[],attributes=slice.call(node.attributes);for(i=0,l=attributes.length;i<l;i++){var attr=attributes[i],binder=Binder.find(attr.name);binder&&bound.push({binder:binder,attr:attr})}bound.sort(sortAttributes);var parent=node.parentNode;for(i=0;i<bound.length;i++){var binder=bound[i].binder,attr=bound[i].attr,name=attr.name,value=attr.value;node.removeAttributeNode(attr);var binding=createBinding(binder,{name:name,expression:Expression.codify(value),match:binder.expr?name.match(binder.expr)[1]:void 0});if(bindings.push(binding),node.parentNode!==parent)break}}return bindings}function splitTextNode(node){if(!node.processed){node.processed=!0;var content=node.nodeValue;if(content.match(boundExpr)){for(var expr,lastIndex=0,parts=[],fragment=document.createDocumentFragment();expr=boundExpr.exec(content);)parts.push(content.slice(lastIndex,boundExpr.lastIndex-expr[0].length)),parts.push(expr[0]),lastIndex=boundExpr.lastIndex;parts.push(content.slice(lastIndex)),parts=parts.filter(notEmpty),node.nodeValue=parts[0];for(var i=1;i<parts.length;i++){var newTextNode=document.createTextNode(parts[i]);newTextNode.processed=!0,fragment.appendChild(newTextNode)}node.parentNode.insertBefore(fragment,node.nextSibling)}}}function cloneBinding(binding,view){var node=view;binding.elementPath.forEach(function(index){node=node.childNodes[index]});var binding=new Binding(binding);return binding.element=node,binding.view=view,binding}function isBound(text){return boundExpr.test(text)}function sortAttributes(a,b){return b.binder.priority-a.binder.priority}function notEmpty(value){return!!value}var Template=require("./template"),Binder=require("./binder"),Binding=require("./binding"),Expression=require("./expression"),slice=Array.prototype.slice;Template.addHook("compile",compileTemplate),Template.addHook("view",initializeView),Template.addHook("dispose",cleanupView),Template.viewMethods.bind=bindView,Template.viewMethods.unbind=unbindView;var boundExpr=/{{(.*?)}}/g},{"./binder":1,"./binding":3,"./expression":5,"./template":10}],9:[function(require,module,exports){function Observer(expr,callback,callbackContext){this.getter=expression.get(expr),this.setter=expression.getSetter(expr,{ignoreErrors:!0}),this.callback=callback,this.callbackContext=callbackContext,this.skip=!1,this.context=null,this.oldValue=void 0}module.exports=Observer;var expression=require("./expression"),formatters=require("./formatter").formatters,diff=require("./diff");Observer.prototype={bind:function(context,skipUpdate){this.context=context,this.callback&&Observer.add(this,skipUpdate)},unbind:function(){this.context=null,Observer.remove(this),this.sync()},get:function(){return this.context?this.getter.call(this.context,formatters):void 0},set:function(value){return this.context&&this.setter?this.setter.call(this.context,formatters,value):void 0},skipNextSync:function(){this.skip=!0},sync:function(){var value=this.get();if(this.skip||!this.callback)this.skip=!1;else{
var changed=diff.values(value,this.oldValue);if(!changed)return;Array.isArray(changed)?this.callback.call(this.callbackContext,value,this.oldValue,changed):this.callback.call(this.callbackContext,value,this.oldValue)}this.oldValue=diff.clone(value)}},Observer.observers=[],Observer.callbacks=[],Observer.listeners=[],Observer.add=function(observer,skipUpdate){this.observers.push(observer),skipUpdate||observer.sync()},Observer.remove=function(observer){var index=this.observers.indexOf(observer);return-1!==index?(this.observers.splice(index,1),!0):!1},Observer.syncing=!1,Observer.rerun=!1,Observer.cycles=0,Observer.max=10,Observer.timeout=null,Observer.sync=function(callback){if("function"==typeof callback&&this.afterSync(callback),this.syncing)return this.rerun=!0,!1;for(this.syncing=!0,this.rerun=!0,this.cycles=0;this.rerun;){if(++this.cycles===this.max)throw new Error("Infinite observer syncing, an observer is calling Observer.sync() too many times");this.rerun=!1;for(var i=0;i<this.observers.length;i++)this.observers[i].sync()}for(;this.callbacks.length;)this.callbacks.shift()();for(var i=0,l=this.listeners.length;l>i;i++){var listener=this.listeners[i];listener()}return this.syncing=!1,this.cycles=0,!0},Observer.syncLater=function(callback){if(this.timeout)return!1;var _this=this;return this.timeout=setTimeout(function(){_this.timeout=null,_this.sync(callback)}),!0},Observer.afterSync=function(callback){if("function"==typeof callback)throw new TypeError("callback must be a function");this.callbacks.push(callback)},Observer.onSync=function(listener){if("function"==typeof listener)throw new TypeError("listener must be a function");this.listeners.push(listener)},Observer.removeOnSync=function(listener){if("function"==typeof listener)throw new TypeError("listener must be a function");var index=this.listeners.indexOf(listener);-1!==index&&this.listeners.splice(index,1).pop()}},{"./diff":4,"./expression":5,"./formatter":6}],10:[function(require,module,exports){function addHook(type,hook){if("function"!=typeof hook)throw new TypeError("A hook must be a function");if(!hooks[type])throw new TypeError("Invalid type for hook");hooks[type].push(hook)}function removeHook(type,hook){if("function"!=typeof hook)throw new TypeError("A hook must be a function");if(!hooks[type])throw new TypeError("Invalid type for hook");var index=hooks[type].indexOf(item);return index>=0&&hooks[type].splice(index,1),index>=0}function createTemplate(html){var fragment=toFragment(html);if(0===fragment.childNodes.length)throw new Error("Cannot create a template from "+html);return Object.keys(exports.templateMethods).forEach(function(key){fragment[key]=exports.templateMethods[key]}),fragment.pool=[],runHooks("compile",fragment),fragment}function templateCreateView(){return this.pool.pop()||createView(this.cloneNode(!0),this)}function createView(fragment,template){if(!(fragment instanceof Node))throw new TypeError("A view must be created from an HTML Node");if(fragment.nodeType!==Node.DOCUMENT_FRAGMENT_NODE){var node=fragment;fragment=document.createDocumentFragment(),fragment.firstViewNode=fragment.lastViewNode=node}else fragment.firstViewNode=fragment.firstChild,fragment.lastViewNode=fragment.lastChild;return Object.keys(exports.viewMethods).forEach(function(key){fragment[key]=exports.viewMethods[key]}),fragment.template=template,runHooks("view",fragment),fragment}function removeView(){var next,node=this.firstViewNode;if(node.parentNode!==this)for(;node;)next=node===this.lastViewNode?null:node.nextSibling,this.appendChild(node),node=next;return this}function disposeView(){this.remove(),runHooks("dispose",this),this.template&&this.template.pool.push(this)}function runHooks(type,value){hooks[type].forEach(function(hook){hook(value)})}var toFragment=require("./toFragment");exports.createTemplate=createTemplate,exports.createView=createView,exports.addHook=addHook,exports.removeHook=removeHook;var hooks={compile:[],view:[],dispose:[]};exports.templateMethods={createView:templateCreateView},exports.viewMethods={remove:removeView,dispose:disposeView}},{"./toFragment":11}],11:[function(require,module,exports){function toFragment(html){if(html instanceof DocumentFragment)return html;if("string"==typeof html)return stringToFragment(html);if(html instanceof Node)return nodeToFragment(html);if(html.hasOwnProperty("length"))return listToFragment(html);throw new TypeError("Unsupported Template Type: Cannot convert `"+html+"` into a document fragment.")}function nodeToFragment(node){if(node.content instanceof DocumentFragment)return node.content;if("SCRIPT"===node.tagName)return stringToFragment(node.innerHTML);var fragment=document.createDocumentFragment();if("TEMPLATE"===node.tagName)for(var i=0,l=node.childNodes.length;l>i;i++)fragment.appendChild(node.childNodes[i]);else fragment.appendChild(node);return fragment}function listToFragment(list){for(var fragment=document.createDocumentFragment(),i=0,l=list.length;l>i;i++)fragment.appendChild(toFragment(list[i]));return fragment}function stringToFragment(string){var templateElement;return templateElement=document.createElement("template"),templateElement.innerHTML=string,templateElement.content}module.exports=toFragment,!document.createElement("template").content instanceof DocumentFragment&&(stringToFragment=function(){var tagExp=/<([\w:-]+)/,wrapMap={option:[1,'<select multiple="multiple">',"</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};return wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,function(string){var tag=string.match(tagExp),parts=wrapMap[tag]||wrapMap._default,depth=parts[0],prefix=parts[1],postfix=parts[2],div=document.createElement("div");for(div.innerHTML=prefix+string+postfix;depth--;)div=div.lastChild;for(var fragment=document.createDocumentFragment();div.firstChild;)fragment.appendChild(div.firstChild);return fragment}}())},{}],12:[function(require,module,exports){exports.Observer=require("./src/observer"),exports.diff=require("./src/diff"),exports.Template=require("./src/template"),exports.Expression=require("./src/expression"),exports.Binding=require("./src/binding"),exports.Binder=require("./src/binder"),exports.Formatter=require("./src/formatter"),require("./src/binders"),require("./src/formatters"),require("./src/initBinding")},{"./src/binder":1,"./src/binders":2,"./src/binding":3,"./src/diff":4,"./src/expression":5,"./src/formatter":6,"./src/formatters":7,"./src/initBinding":8,"./src/observer":9,"./src/template":10}]},{},[12])(12)});